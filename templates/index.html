<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emotion Detection ‚Äî Text & Audio</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary: #6b5bff;
      --secondary: #5ac8fa;
      --bg: #f2f4f8;
      --card: #ffffff;
      --muted: #636e72;
      --accent: linear-gradient(90deg,#6b5bff,#5ac8fa);
      --transition: .25s ease;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: #0d1b2a;
      overflow-x: hidden;
    }

    .hero-card {
      background: var(--accent);
      padding: 32px;
      color: white;
      border-radius: 18px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      margin-bottom: 40px;
      text-align: center;
    }

    .app-card {
      background: var(--card);
      border-radius: 16px;
      padding: 28px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.06);
      transition: var(--transition);
    }

    .app-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.08);
    }

    .tab-btn {
      border: none;
      background: #e2e7ff;
      font-weight: 600;
      color: #4c4f66;
      padding: 10px 18px;
      border-radius: 12px;
      transition: var(--transition);
    }

    .tab-btn:hover {
      background: #d6dbff;
    }

    .tab-btn.active {
      color: #fff;
      background: var(--primary);
      box-shadow: 0 6px 16px rgba(107,91,255,0.2);
    }

    textarea {
      min-height: 170px;
      border-radius: 14px;
      border: 1px solid #dfe4ea;
      padding: 18px;
      background: #fdfdfd;
      transition: var(--transition);
    }

    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(107,91,255,0.2);
    }

    .result-badge {
      background: #eef1ff;
      padding: 10px 16px;
      border-radius: 30px;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--primary);
      box-shadow: 0 6px 15px rgba(0,0,0,0.05);
    }

    .confidence-badge {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      margin-left: 10px;
    }

    .audio-preview {
      display:flex;
      gap:12px;
      align-items:center;
      padding: 12px;
      background: #f8faff;
      border-radius: 12px;
      border: 1px solid #e5e9f2;
    }

    .muted {
      color: var(--muted);
    }

    .btn-primary {
      background: var(--primary);
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      transition: var(--transition);
      font-weight: 600;
    }

    .btn-primary:hover {
      background: #584dff;
    }

    .btn-outline-secondary {
      border-radius: 12px;
    }

    .result-card {
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .text-result {
      background: #f8faff;
      border-left: 4px solid var(--primary);
    }

    .audio-result {
      background: #effff5;
      border-left: 4px solid #4caf50;
    }

    .alert-section {
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .left-col {
        border-right: none !important;
        border-bottom: 1px dashed #dcdde1;
        padding-bottom: 30px;
      }
    }
  </style>
</head>

<body>

<div class="container py-5">

  <!-- Hero Section -->
  <div class="hero-card">
    <h1 class="fw-bold">üé≠ Emotion Detection</h1>
    <p class="mt-2 mb-0">Analyze emotions from text or audio with Deep Learning.</p>
  </div>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="alert-section">
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'danger' else 'warning' if category == 'warning' else 'info' }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="row g-4">

    <!-- FORM SECTION -->
    <div class="col-lg-6 left-col">
      <div class="app-card h-100">

        <div class="d-flex gap-2 mb-4 justify-content-center">
          <button class="tab-btn active" id="tabTextBtn" onclick="switchTab('text')">üìù Text</button>
          <button class="tab-btn" id="tabAudioBtn" onclick="switchTab('audio')">üéµ Audio</button>
        </div>

        <!-- Text Form -->
        <div id="tab-text">
          <form action="{{ url_for('predict_text') }}" method="post" onsubmit="onSubmitBtn('text')">
            <label for="textInput" class="form-label fw-semibold">Enter Text</label>
            <textarea id="textInput" name="sentence" class="form-control"
              placeholder="Example: I am feeling great today!" required>{{ request.form.sentence or '' }}</textarea>

            <div class="d-flex justify-content-between mt-3">
              <small class="muted">Characters: <span id="charCount">0</span></small>
              <div>
                <button type="submit" class="btn btn-primary">Analyze</button>
                <button type="button" class="btn btn-outline-secondary"
                  onclick="document.getElementById('textInput').value=''; updateCharCount();">Clear</button>
              </div>
            </div>
          </form>
        </div>

        <!-- Audio Form -->
        <div id="tab-audio" style="display:none;">
          <form action="{{ url_for('predict_audio') }}" method="post" enctype="multipart/form-data"
            onsubmit="onSubmitBtn('audio')">

            <label class="form-label fw-semibold">Upload Audio File</label>
            <input type="file" id="audioFile" name="audio" accept=".wav,.mp3,.m4a,.flac,.ogg,.aiff" class="form-control" onchange="onLoadAudio(event)" required>
            
            <div class="mt-2">
              <small class="muted">Supported formats: WAV, MP3, M4A, FLAC, OGG, AIFF</small>
            </div>

            <div class="audio-preview mt-3" id="audioPreview" style="display:none;">
              <audio id="player" controls style="width: 100%;"></audio>
              <div>
                <small class="muted">Selected File</small>
                <div id="audioName" class="fw-semibold"></div>
              </div>
            </div>

            <div class="d-flex justify-content-between mt-3">
              <small class="muted">Max recommended: 10 MB</small>
              <div>
                <button type="submit" class="btn btn-primary">Analyze</button>
                <button type="button" class="btn btn-outline-secondary" onclick="resetAudio()">Reset</button>
              </div>
            </div>

          </form>
        </div>

      </div>
    </div>

    <!-- RESULTS SECTION -->
    <div class="col-lg-6">
      <div class="app-card h-100">

        <h5 class="fw-bold mb-3">üìä Results</h5>

        <!-- Text Result -->
        {% if predicted_emotion_text %}
        <div class="result-card text-result">
          <div class="d-flex align-items-center mb-2">
            <div class="result-badge">
              üîé {{ predicted_emotion_text }}
            </div>
            {% if predicted_confidence_text %}
            <div class="confidence-badge">
              {{ (predicted_confidence_text * 100)|round(1) }}%
            </div>
            {% endif %}
          </div>
          <p class="mt-2 mb-1"><strong>Input:</strong></p>
          <p class="muted">{{ request.form.sentence or 'N/A' }}</p>
        </div>
        {% endif %}

        <!-- Audio Result -->
        {% if predicted_emotion_audio %}
        <div class="result-card audio-result">
          <div class="d-flex align-items-center mb-2">
            <div class="result-badge">
              üîä {{ predicted_emotion_audio }}
            </div>
            {% if predicted_confidence_audio %}
            <div class="confidence-badge">
              {{ (predicted_confidence_audio * 100)|round(1) }}%
            </div>
            {% endif %}
          </div>
          
          <p class="mt-2 mb-1"><strong>Audio:</strong></p>
          <audio controls style="width:100%;">
            <source src="{{ url_for('uploaded_file', filename=audio_path.split('/')[-1]) }}">
            Your browser does not support the audio element.
          </audio>
        </div>
        {% endif %}

        {% if not predicted_emotion_audio and not predicted_emotion_text %}
        <div class="text-center muted py-5">
          <div class="mb-3">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <h5 class="fw-semibold">No results yet</h5>
          <p class="muted">Submit text or audio to see analysis results.</p>
        </div>
        {% endif %}

      </div>
    </div>

  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Tab Switch
  function switchTab(type){
    document.getElementById('tab-text').style.display = (type === 'text') ? '' : 'none';
    document.getElementById('tab-audio').style.display = (type === 'audio') ? '' : 'none';

    document.getElementById('tabTextBtn').classList.toggle('active', type === 'text');
    document.getElementById('tabAudioBtn').classList.toggle('active', type === 'audio');
    
    // Clear any flash messages when switching tabs
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
      const bsAlert = new bootstrap.Alert(alert);
      bsAlert.close();
    });
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    // Show text tab by default
    switchTab('text');
    
    // Update character count if there's existing text
    updateCharCount();
  });

  // Character Count
  const textInput = document.getElementById('textInput');
  const charCount = document.getElementById('charCount');

  function updateCharCount(){
    charCount.textContent = textInput.value.length;
  }
  textInput.addEventListener('input', updateCharCount);

  // Audio Preview
  function onLoadAudio(e){
    const file = e.target.files[0];
    if(!file) return;

    document.getElementById('audioPreview').style.display = 'flex';
    document.getElementById('audioName').textContent = file.name;

    const url = URL.createObjectURL(file);
    const player = document.getElementById('player');
    player.src = url;
    player.load();
  }

  function resetAudio(){
    document.getElementById('audioFile').value = '';
    document.getElementById('audioPreview').style.display = 'none';
    const player = document.getElementById('player');
    player.src = '';
  }

  // Loading state for submit buttons
  function onSubmitBtn(type) {
    const btn = document.querySelector(type === 'text' ? 
      '#tab-text button[type="submit"]' : 
      '#tab-audio button[type="submit"]');
    
    if (btn) {
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Analyzing...';
      btn.disabled = true;
      
      // Reset after 5 seconds in case of error
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }, 5000);
    }
  }
</script>

</body>
</html>